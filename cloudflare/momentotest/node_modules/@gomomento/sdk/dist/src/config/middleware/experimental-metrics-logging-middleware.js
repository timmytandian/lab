"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.ExperimentalMetricsLoggingMiddleware = void 0;
const experimental_metrics_middleware_1 = require("./impl/experimental-metrics-middleware");
const perf_hooks_1 = require("perf_hooks");
class ExperimentalMetricsLoggingMiddlewareRequestHandler extends experimental_metrics_middleware_1.ExperimentalMetricsMiddlewareRequestHandler {
    constructor(parent, logger, context) {
        super(parent, logger, context);
    }
    emitMetrics(metrics) {
        this.logger.info(JSON.stringify(metrics));
        return Promise.resolve();
    }
}
/**
 * This middleware enables per-request client-side metrics.  Metrics for each
 * request will be written to logs; the log data can be analyzed or shared
 * with Momento to diagnose performance issues.
 *
 * The metrics format is currently considered experimental; in a future release,
 * once the format is considered stable, this class will be renamed to remove
 * the Experimental prefix.
 *
 * It also enables regular logging of congestion in the node event loop. Once
 * per second it will output the event loop utilization ratio, as well as stats
 * about the event loop delay, measured in 20ms increments.
 *
 * WARNING: enabling this middleware may have minor performance implications,
 * so enable with caution.
 *
 * WARNING: depending on your request volume, this middleware will produce a high
 * volume of log output. If you are writing logs directly to local disk, be aware
 * of disk usage and make sure you have log rotation / compression enabled via a
 * tool such as `logrotate`.
 *
 * See `advanced.ts` in the examples directory for an example of how to set up
 * your {Configuration} to enable this middleware.
 */
class ExperimentalMetricsLoggingMiddleware extends experimental_metrics_middleware_1.ExperimentalMetricsMiddleware {
    constructor(loggerFactory) {
        super(loggerFactory, (p, l, c) => new ExperimentalMetricsLoggingMiddlewareRequestHandler(p, l, c));
        if (!ExperimentalMetricsLoggingMiddleware.isLoggingStarted) {
            ExperimentalMetricsLoggingMiddleware.isLoggingStarted = true;
            ExperimentalMetricsLoggingMiddleware.startLogging(this.logger);
        }
    }
    static startLogging(logger) {
        this.eldMonitor = (0, perf_hooks_1.monitorEventLoopDelay)({
            resolution: this.eventLoopDelayInterval,
        });
        this.eldMonitor.enable();
        this.elu = perf_hooks_1.performance.eventLoopUtilization();
        setInterval(() => {
            this.elu = perf_hooks_1.performance.eventLoopUtilization(this.elu);
            const metrics = {
                eventLoopUtilization: this.elu.utilization,
                eventLoopDelayMean: this.eldMonitor.mean,
                eventLoopDelayMin: this.eldMonitor.min,
                eventLoopDelayP50: this.eldMonitor.percentile(50),
                eventLoopDelayP75: this.eldMonitor.percentile(75),
                eventLoopDelayP90: this.eldMonitor.percentile(90),
                eventLoopDelayP95: this.eldMonitor.percentile(95),
                eventLoopDelayP99: this.eldMonitor.percentile(99),
                eventLoopDelayMax: this.eldMonitor.max,
            };
            logger.info(JSON.stringify(metrics));
            this.eldMonitor.reset();
        }, this.metricsLogInterval);
    }
}
exports.ExperimentalMetricsLoggingMiddleware = ExperimentalMetricsLoggingMiddleware;
ExperimentalMetricsLoggingMiddleware.metricsLogInterval = 1000;
ExperimentalMetricsLoggingMiddleware.eventLoopDelayInterval = 20;
ExperimentalMetricsLoggingMiddleware.isLoggingStarted = false;
ExperimentalMetricsLoggingMiddleware.numActiveRequests = 0;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZXhwZXJpbWVudGFsLW1ldHJpY3MtbG9nZ2luZy1taWRkbGV3YXJlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL2NvbmZpZy9taWRkbGV3YXJlL2V4cGVyaW1lbnRhbC1tZXRyaWNzLWxvZ2dpbmctbWlkZGxld2FyZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFDQSw0RkFJZ0Q7QUFFaEQsMkNBS29CO0FBaURwQixNQUFNLGtEQUFtRCxTQUFRLDZFQUEyQztJQUMxRyxZQUNFLE1BQXFDLEVBQ3JDLE1BQXFCLEVBQ3JCLE9BQXdDO1FBRXhDLEtBQUssQ0FBQyxNQUFNLEVBQUUsTUFBTSxFQUFFLE9BQU8sQ0FBQyxDQUFDO0lBQ2pDLENBQUM7SUFFRCxXQUFXLENBQUMsT0FBbUM7UUFDN0MsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDO1FBQzFDLE9BQU8sT0FBTyxDQUFDLE9BQU8sRUFBRSxDQUFDO0lBQzNCLENBQUM7Q0FDRjtBQUVEOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztHQXVCRztBQUNILE1BQWEsb0NBQXFDLFNBQVEsK0RBQTZCO0lBUXJGLFlBQVksYUFBbUM7UUFDN0MsS0FBSyxDQUNILGFBQWEsRUFDYixDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FDVixJQUFJLGtEQUFrRCxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQ2xFLENBQUM7UUFDRixJQUFJLENBQUMsb0NBQW9DLENBQUMsZ0JBQWdCLEVBQUU7WUFDMUQsb0NBQW9DLENBQUMsZ0JBQWdCLEdBQUcsSUFBSSxDQUFDO1lBQzdELG9DQUFvQyxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7U0FDaEU7SUFDSCxDQUFDO0lBRU8sTUFBTSxDQUFDLFlBQVksQ0FBQyxNQUFxQjtRQUMvQyxJQUFJLENBQUMsVUFBVSxHQUFHLElBQUEsa0NBQXFCLEVBQUM7WUFDdEMsVUFBVSxFQUFFLElBQUksQ0FBQyxzQkFBc0I7U0FDeEMsQ0FBQyxDQUFDO1FBQ0gsSUFBSSxDQUFDLFVBQVUsQ0FBQyxNQUFNLEVBQUUsQ0FBQztRQUN6QixJQUFJLENBQUMsR0FBRyxHQUFHLHdCQUFXLENBQUMsb0JBQW9CLEVBQUUsQ0FBQztRQUU5QyxXQUFXLENBQUMsR0FBRyxFQUFFO1lBQ2YsSUFBSSxDQUFDLEdBQUcsR0FBRyx3QkFBVyxDQUFDLG9CQUFvQixDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUN0RCxNQUFNLE9BQU8sR0FBaUI7Z0JBQzVCLG9CQUFvQixFQUFFLElBQUksQ0FBQyxHQUFHLENBQUMsV0FBVztnQkFDMUMsa0JBQWtCLEVBQUUsSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJO2dCQUN4QyxpQkFBaUIsRUFBRSxJQUFJLENBQUMsVUFBVSxDQUFDLEdBQUc7Z0JBQ3RDLGlCQUFpQixFQUFFLElBQUksQ0FBQyxVQUFVLENBQUMsVUFBVSxDQUFDLEVBQUUsQ0FBQztnQkFDakQsaUJBQWlCLEVBQUUsSUFBSSxDQUFDLFVBQVUsQ0FBQyxVQUFVLENBQUMsRUFBRSxDQUFDO2dCQUNqRCxpQkFBaUIsRUFBRSxJQUFJLENBQUMsVUFBVSxDQUFDLFVBQVUsQ0FBQyxFQUFFLENBQUM7Z0JBQ2pELGlCQUFpQixFQUFFLElBQUksQ0FBQyxVQUFVLENBQUMsVUFBVSxDQUFDLEVBQUUsQ0FBQztnQkFDakQsaUJBQWlCLEVBQUUsSUFBSSxDQUFDLFVBQVUsQ0FBQyxVQUFVLENBQUMsRUFBRSxDQUFDO2dCQUNqRCxpQkFBaUIsRUFBRSxJQUFJLENBQUMsVUFBVSxDQUFDLEdBQUc7YUFDdkMsQ0FBQztZQUNGLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDO1lBQ3JDLElBQUksQ0FBQyxVQUFVLENBQUMsS0FBSyxFQUFFLENBQUM7UUFDMUIsQ0FBQyxFQUFFLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO0lBQzlCLENBQUM7O0FBM0NILG9GQTRDQztBQTNDeUIsdURBQWtCLEdBQUcsSUFBSSxDQUFDO0FBQzFCLDJEQUFzQixHQUFHLEVBQUUsQ0FBQztBQUdyQyxxREFBZ0IsR0FBRyxLQUFLLENBQUM7QUFDakMsc0RBQWlCLEdBQUcsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtNb21lbnRvTG9nZ2VyLCBNb21lbnRvTG9nZ2VyRmFjdG9yeX0gZnJvbSAnLi4vLi4vJztcbmltcG9ydCB7XG4gIEV4cGVyaW1lbnRhbE1ldHJpY3NNaWRkbGV3YXJlLFxuICBFeHBlcmltZW50YWxNZXRyaWNzTWlkZGxld2FyZVJlcXVlc3RIYW5kbGVyLFxuICBFeHBlcmltZW50YWxSZXF1ZXN0TWV0cmljcyxcbn0gZnJvbSAnLi9pbXBsL2V4cGVyaW1lbnRhbC1tZXRyaWNzLW1pZGRsZXdhcmUnO1xuaW1wb3J0IHtNaWRkbGV3YXJlUmVxdWVzdEhhbmRsZXJDb250ZXh0fSBmcm9tICcuL21pZGRsZXdhcmUnO1xuaW1wb3J0IHtcbiAgRXZlbnRMb29wRGVsYXlNb25pdG9yLFxuICBFdmVudExvb3BVdGlsaXphdGlvbixcbiAgbW9uaXRvckV2ZW50TG9vcERlbGF5LFxuICBwZXJmb3JtYW5jZSxcbn0gZnJvbSAncGVyZl9ob29rcyc7XG5cbmludGVyZmFjZSBTdGF0ZU1ldHJpY3Mge1xuICAvKipcbiAgICogVGhlIHByb3BvcnRpb24gb2YgdGltZSB0aGUgZXZlbnQgbG9vcCB3YXMgYnVzeSBvdmVyIHRoZSBsYXN0IHNlY29uZC5cbiAgICovXG4gIGV2ZW50TG9vcFV0aWxpemF0aW9uOiBudW1iZXI7XG5cbiAgLyoqXG4gICAqIFRoZSBhdmVyYWdlIGV2ZW50IGxvb3AgZGVsYXkgb3ZlciB0aGUgbGFzdCBzZWNvbmQsIG1lYXN1cmVkIGluIDIwbXMgaW5jcmVtZW50cy5cbiAgICovXG4gIGV2ZW50TG9vcERlbGF5TWVhbjogbnVtYmVyO1xuXG4gIC8qKlxuICAgKiBUaGUgbWluaW11bSBldmVudCBsb29wIGRlbGF5IG92ZXIgdGhlIGxhc3Qgc2Vjb25kLCBtZWFzdXJlZCBpbiAyMG1zIGluY3JlbWVudHMuXG4gICAqL1xuICBldmVudExvb3BEZWxheU1pbjogbnVtYmVyO1xuXG4gIC8qKlxuICAgKiBUaGUgNTB0aCBwZXJjZW50aWxlIGV2ZW50IGxvb3AgZGVsYXkgb3ZlciB0aGUgbGFzdCBzZWNvbmQsIG1lYXN1cmVkIGluIDIwbXMgaW5jcmVtZW50cy5cbiAgICovXG4gIGV2ZW50TG9vcERlbGF5UDUwOiBudW1iZXI7XG5cbiAgLyoqXG4gICAqIFRoZSA3NXRoIHBlcmNlbnRpbGUgZXZlbnQgbG9vcCBkZWxheSBvdmVyIHRoZSBsYXN0IHNlY29uZCwgbWVhc3VyZWQgaW4gMjBtcyBpbmNyZW1lbnRzLlxuICAgKi9cbiAgZXZlbnRMb29wRGVsYXlQNzU6IG51bWJlcjtcblxuICAvKipcbiAgICogVGhlIDkwdGggcGVyY2VudGlsZSBldmVudCBsb29wIGRlbGF5IG92ZXIgdGhlIGxhc3Qgc2Vjb25kLCBtZWFzdXJlZCBpbiAyMG1zIGluY3JlbWVudHMuXG4gICAqL1xuICBldmVudExvb3BEZWxheVA5MDogbnVtYmVyO1xuXG4gIC8qKlxuICAgKiBUaGUgOTV0aCBwZXJjZW50aWxlIGV2ZW50IGxvb3AgZGVsYXkgb3ZlciB0aGUgbGFzdCBzZWNvbmQsIG1lYXN1cmVkIGluIDIwbXMgaW5jcmVtZW50cy5cbiAgICovXG4gIGV2ZW50TG9vcERlbGF5UDk1OiBudW1iZXI7XG5cbiAgLyoqXG4gICAqIFRoZSA5OXRoIHBlcmNlbnRpbGUgZXZlbnQgbG9vcCBkZWxheSBvdmVyIHRoZSBsYXN0IHNlY29uZCwgbWVhc3VyZWQgaW4gMjBtcyBpbmNyZW1lbnRzLlxuICAgKi9cbiAgZXZlbnRMb29wRGVsYXlQOTk6IG51bWJlcjtcblxuICAvKipcbiAgICogVGhlIG1heGltdW0gZXZlbnQgbG9vcCBkZWxheSBvdmVyIHRoZSBsYXN0IHNlY29uZCwgbWVhc3VyZWQgaW4gMjBtcyBpbmNyZW1lbnRzLlxuICAgKi9cbiAgZXZlbnRMb29wRGVsYXlNYXg6IG51bWJlcjtcbn1cblxuY2xhc3MgRXhwZXJpbWVudGFsTWV0cmljc0xvZ2dpbmdNaWRkbGV3YXJlUmVxdWVzdEhhbmRsZXIgZXh0ZW5kcyBFeHBlcmltZW50YWxNZXRyaWNzTWlkZGxld2FyZVJlcXVlc3RIYW5kbGVyIHtcbiAgY29uc3RydWN0b3IoXG4gICAgcGFyZW50OiBFeHBlcmltZW50YWxNZXRyaWNzTWlkZGxld2FyZSxcbiAgICBsb2dnZXI6IE1vbWVudG9Mb2dnZXIsXG4gICAgY29udGV4dDogTWlkZGxld2FyZVJlcXVlc3RIYW5kbGVyQ29udGV4dFxuICApIHtcbiAgICBzdXBlcihwYXJlbnQsIGxvZ2dlciwgY29udGV4dCk7XG4gIH1cblxuICBlbWl0TWV0cmljcyhtZXRyaWNzOiBFeHBlcmltZW50YWxSZXF1ZXN0TWV0cmljcyk6IFByb21pc2U8dm9pZD4ge1xuICAgIHRoaXMubG9nZ2VyLmluZm8oSlNPTi5zdHJpbmdpZnkobWV0cmljcykpO1xuICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcbiAgfVxufVxuXG4vKipcbiAqIFRoaXMgbWlkZGxld2FyZSBlbmFibGVzIHBlci1yZXF1ZXN0IGNsaWVudC1zaWRlIG1ldHJpY3MuICBNZXRyaWNzIGZvciBlYWNoXG4gKiByZXF1ZXN0IHdpbGwgYmUgd3JpdHRlbiB0byBsb2dzOyB0aGUgbG9nIGRhdGEgY2FuIGJlIGFuYWx5emVkIG9yIHNoYXJlZFxuICogd2l0aCBNb21lbnRvIHRvIGRpYWdub3NlIHBlcmZvcm1hbmNlIGlzc3Vlcy5cbiAqXG4gKiBUaGUgbWV0cmljcyBmb3JtYXQgaXMgY3VycmVudGx5IGNvbnNpZGVyZWQgZXhwZXJpbWVudGFsOyBpbiBhIGZ1dHVyZSByZWxlYXNlLFxuICogb25jZSB0aGUgZm9ybWF0IGlzIGNvbnNpZGVyZWQgc3RhYmxlLCB0aGlzIGNsYXNzIHdpbGwgYmUgcmVuYW1lZCB0byByZW1vdmVcbiAqIHRoZSBFeHBlcmltZW50YWwgcHJlZml4LlxuICpcbiAqIEl0IGFsc28gZW5hYmxlcyByZWd1bGFyIGxvZ2dpbmcgb2YgY29uZ2VzdGlvbiBpbiB0aGUgbm9kZSBldmVudCBsb29wLiBPbmNlXG4gKiBwZXIgc2Vjb25kIGl0IHdpbGwgb3V0cHV0IHRoZSBldmVudCBsb29wIHV0aWxpemF0aW9uIHJhdGlvLCBhcyB3ZWxsIGFzIHN0YXRzXG4gKiBhYm91dCB0aGUgZXZlbnQgbG9vcCBkZWxheSwgbWVhc3VyZWQgaW4gMjBtcyBpbmNyZW1lbnRzLlxuICpcbiAqIFdBUk5JTkc6IGVuYWJsaW5nIHRoaXMgbWlkZGxld2FyZSBtYXkgaGF2ZSBtaW5vciBwZXJmb3JtYW5jZSBpbXBsaWNhdGlvbnMsXG4gKiBzbyBlbmFibGUgd2l0aCBjYXV0aW9uLlxuICpcbiAqIFdBUk5JTkc6IGRlcGVuZGluZyBvbiB5b3VyIHJlcXVlc3Qgdm9sdW1lLCB0aGlzIG1pZGRsZXdhcmUgd2lsbCBwcm9kdWNlIGEgaGlnaFxuICogdm9sdW1lIG9mIGxvZyBvdXRwdXQuIElmIHlvdSBhcmUgd3JpdGluZyBsb2dzIGRpcmVjdGx5IHRvIGxvY2FsIGRpc2ssIGJlIGF3YXJlXG4gKiBvZiBkaXNrIHVzYWdlIGFuZCBtYWtlIHN1cmUgeW91IGhhdmUgbG9nIHJvdGF0aW9uIC8gY29tcHJlc3Npb24gZW5hYmxlZCB2aWEgYVxuICogdG9vbCBzdWNoIGFzIGBsb2dyb3RhdGVgLlxuICpcbiAqIFNlZSBgYWR2YW5jZWQudHNgIGluIHRoZSBleGFtcGxlcyBkaXJlY3RvcnkgZm9yIGFuIGV4YW1wbGUgb2YgaG93IHRvIHNldCB1cFxuICogeW91ciB7Q29uZmlndXJhdGlvbn0gdG8gZW5hYmxlIHRoaXMgbWlkZGxld2FyZS5cbiAqL1xuZXhwb3J0IGNsYXNzIEV4cGVyaW1lbnRhbE1ldHJpY3NMb2dnaW5nTWlkZGxld2FyZSBleHRlbmRzIEV4cGVyaW1lbnRhbE1ldHJpY3NNaWRkbGV3YXJlIHtcbiAgcHJpdmF0ZSBzdGF0aWMgcmVhZG9ubHkgbWV0cmljc0xvZ0ludGVydmFsID0gMTAwMDtcbiAgcHJpdmF0ZSBzdGF0aWMgcmVhZG9ubHkgZXZlbnRMb29wRGVsYXlJbnRlcnZhbCA9IDIwO1xuICBwcml2YXRlIHN0YXRpYyBlbGRNb25pdG9yOiBFdmVudExvb3BEZWxheU1vbml0b3I7XG4gIHByaXZhdGUgc3RhdGljIGVsdTogRXZlbnRMb29wVXRpbGl6YXRpb247XG4gIHByaXZhdGUgc3RhdGljIGlzTG9nZ2luZ1N0YXJ0ZWQgPSBmYWxzZTtcbiAgc3RhdGljIG51bUFjdGl2ZVJlcXVlc3RzID0gMDtcblxuICBjb25zdHJ1Y3Rvcihsb2dnZXJGYWN0b3J5OiBNb21lbnRvTG9nZ2VyRmFjdG9yeSkge1xuICAgIHN1cGVyKFxuICAgICAgbG9nZ2VyRmFjdG9yeSxcbiAgICAgIChwLCBsLCBjKSA9PlxuICAgICAgICBuZXcgRXhwZXJpbWVudGFsTWV0cmljc0xvZ2dpbmdNaWRkbGV3YXJlUmVxdWVzdEhhbmRsZXIocCwgbCwgYylcbiAgICApO1xuICAgIGlmICghRXhwZXJpbWVudGFsTWV0cmljc0xvZ2dpbmdNaWRkbGV3YXJlLmlzTG9nZ2luZ1N0YXJ0ZWQpIHtcbiAgICAgIEV4cGVyaW1lbnRhbE1ldHJpY3NMb2dnaW5nTWlkZGxld2FyZS5pc0xvZ2dpbmdTdGFydGVkID0gdHJ1ZTtcbiAgICAgIEV4cGVyaW1lbnRhbE1ldHJpY3NMb2dnaW5nTWlkZGxld2FyZS5zdGFydExvZ2dpbmcodGhpcy5sb2dnZXIpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgc3RhdGljIHN0YXJ0TG9nZ2luZyhsb2dnZXI6IE1vbWVudG9Mb2dnZXIpOiB2b2lkIHtcbiAgICB0aGlzLmVsZE1vbml0b3IgPSBtb25pdG9yRXZlbnRMb29wRGVsYXkoe1xuICAgICAgcmVzb2x1dGlvbjogdGhpcy5ldmVudExvb3BEZWxheUludGVydmFsLFxuICAgIH0pO1xuICAgIHRoaXMuZWxkTW9uaXRvci5lbmFibGUoKTtcbiAgICB0aGlzLmVsdSA9IHBlcmZvcm1hbmNlLmV2ZW50TG9vcFV0aWxpemF0aW9uKCk7XG5cbiAgICBzZXRJbnRlcnZhbCgoKSA9PiB7XG4gICAgICB0aGlzLmVsdSA9IHBlcmZvcm1hbmNlLmV2ZW50TG9vcFV0aWxpemF0aW9uKHRoaXMuZWx1KTtcbiAgICAgIGNvbnN0IG1ldHJpY3M6IFN0YXRlTWV0cmljcyA9IHtcbiAgICAgICAgZXZlbnRMb29wVXRpbGl6YXRpb246IHRoaXMuZWx1LnV0aWxpemF0aW9uLFxuICAgICAgICBldmVudExvb3BEZWxheU1lYW46IHRoaXMuZWxkTW9uaXRvci5tZWFuLFxuICAgICAgICBldmVudExvb3BEZWxheU1pbjogdGhpcy5lbGRNb25pdG9yLm1pbixcbiAgICAgICAgZXZlbnRMb29wRGVsYXlQNTA6IHRoaXMuZWxkTW9uaXRvci5wZXJjZW50aWxlKDUwKSxcbiAgICAgICAgZXZlbnRMb29wRGVsYXlQNzU6IHRoaXMuZWxkTW9uaXRvci5wZXJjZW50aWxlKDc1KSxcbiAgICAgICAgZXZlbnRMb29wRGVsYXlQOTA6IHRoaXMuZWxkTW9uaXRvci5wZXJjZW50aWxlKDkwKSxcbiAgICAgICAgZXZlbnRMb29wRGVsYXlQOTU6IHRoaXMuZWxkTW9uaXRvci5wZXJjZW50aWxlKDk1KSxcbiAgICAgICAgZXZlbnRMb29wRGVsYXlQOTk6IHRoaXMuZWxkTW9uaXRvci5wZXJjZW50aWxlKDk5KSxcbiAgICAgICAgZXZlbnRMb29wRGVsYXlNYXg6IHRoaXMuZWxkTW9uaXRvci5tYXgsXG4gICAgICB9O1xuICAgICAgbG9nZ2VyLmluZm8oSlNPTi5zdHJpbmdpZnkobWV0cmljcykpO1xuICAgICAgdGhpcy5lbGRNb25pdG9yLnJlc2V0KCk7XG4gICAgfSwgdGhpcy5tZXRyaWNzTG9nSW50ZXJ2YWwpO1xuICB9XG59XG4iXX0=